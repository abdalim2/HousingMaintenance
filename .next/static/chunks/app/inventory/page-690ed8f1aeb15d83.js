(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[693],{2099:(e,t,s)=>{"use strict";s.d(t,{N:()=>i});let i=(0,s(851).UU)("https://mticvmyfrdmciaeipfxu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10aWN2bXlmcmRtY2lhZWlwZnh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwODc1OTMsImV4cCI6MjA1NjY2MzU5M30.6iudxBl6js0heW1mhoSmcXegTIN_lAN2GiFeA3plSIo")},4625:(e,t,s)=>{Promise.resolve().then(s.bind(s,8987))},6269:(e,t,s)=>{"use strict";s.d(t,{JS:()=>c,K7:()=>l,ZK:()=>d,bW:()=>a,d2:()=>o,st:()=>n,x8:()=>m,zZ:()=>r});var i=s(2099);let a=async()=>{let{data:e,error:t}=await i.N.from("categories").select("*");if(t)throw t;return e||[]},r=async e=>{let{data:t,error:s}=await i.N.from("categories").insert([e]).select().single();if(s)throw s;return t},n=async(e,t)=>{let{data:s,error:a}=await i.N.from("categories").update(t).eq("id",e).select().single();if(a)throw a;return s},l=async e=>{let{error:t}=await i.N.from("categories").delete().eq("id",e);if(t)throw t},c=async e=>{let t=i.N.from("items").select("*");e&&(t=t.eq("category_id",e));let{data:s,error:a}=await t;if(a)throw a;return s||[]},d=async e=>{let t=i.N.from("inventory").select("\n      *,\n      items:item_id (\n        id,\n        name,\n        category_id,\n        unit\n      )\n    ");e&&(t=t.eq("item_id",e));let{data:s,error:a}=await t;if(a)throw a;return s||[]},m=async(e,t)=>{let{data:s,error:a}=await i.N.from("inventory").select("*").eq("item_id",e).single();if(a&&"PGRST116"!==a.code)throw a;if(s){let e=s.quantity+t;if(e<0)throw Error("Insufficient inventory quantity");let{data:a,error:r}=await i.N.from("inventory").update({quantity:e,last_updated:new Date().toISOString()}).eq("id",s.id).select().single();if(r)throw r;return a}if(t>0){let{data:s,error:a}=await i.N.from("inventory").insert([{item_id:e,quantity:t,last_updated:new Date().toISOString()}]).select().single();if(a)throw a;return s}throw Error("Cannot reduce quantity of non-existent inventory item")},o=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,{data:t,error:s}=await i.N.from("inventory").select("\n      *,\n      items:item_id (\n        id,\n        name,\n        category_id,\n        unit\n      )\n    ").lte("quantity",e);if(s)throw s;return t||[]}},8987:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var i=s(5155),a=s(2115),r=s(6874),n=s.n(r),l=s(6269);function c(){let[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)([]),[c,d]=(0,a.useState)(!0),[m,o]=(0,a.useState)(null),[x,h]=(0,a.useState)(""),[u,g]=(0,a.useState)(""),[p,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{d(!0),o(null);try{let[e,s]=await Promise.all([(0,l.ZK)(),(0,l.bW)()]);t(e),r(s)}catch(e){console.error("Error fetching inventory data:",e),o("حدث خطأ أثناء تحميل بيانات المخزون. الرجاء المحاولة مرة أخرى.")}finally{d(!1)}})()},[]);let N=e.filter(e=>{let t=!x||e.items.category_id===x,s=!u||e.items.name.toLowerCase().includes(u.toLowerCase()),i=!p||e.quantity<=5;return t&&s&&i}),f=N.reduce((e,t)=>{let s=t.items.category_id;return e[s]||(e[s]=[]),e[s].push(t),e},{});return(0,i.jsxs)("div",{className:"container mx-auto",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:"المخزون"}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)(n(),{href:"/inventory/categories",className:"btn btn-secondary",children:"إدارة الأصناف"}),(0,i.jsx)(n(),{href:"/inventory/add",className:"btn btn-primary",children:"إضافة مخزون"})]})]}),m&&(0,i.jsx)("div",{className:"bg-red-100 border-r-4 border-red-500 text-red-700 p-4 mb-6 rounded-md",children:(0,i.jsx)("p",{children:m})}),(0,i.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"تصفية المخزون"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"البحث بالاسم"}),(0,i.jsx)("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"ادخل اسم الصنف...",className:"input w-full"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"التصنيف"}),(0,i.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"select w-full",children:[(0,i.jsx)("option",{value:"",children:"جميع التصنيفات"}),s.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,i.jsx)("div",{className:"flex items-end",children:(0,i.jsxs)("label",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"checkbox",checked:p,onChange:e=>y(e.target.checked),className:"w-5 h-5 ml-2"}),(0,i.jsx)("span",{children:"عرض المخزون المنخفض فقط (أقل من 5)"})]})})]})]}),c?(0,i.jsx)("div",{className:"text-center py-10",children:(0,i.jsx)("p",{className:"text-lg",children:"جاري تحميل البيانات..."})}):0===N.length?(0,i.jsx)("div",{className:"bg-white shadow-md rounded-lg p-6 text-center",children:(0,i.jsx)("p",{className:"text-lg text-gray-500",children:"لا توجد أصناف مطابقة للمعايير المحددة."})}):(0,i.jsx)("div",{className:"space-y-6",children:Object.keys(f).map(e=>{var t;let a=(null==(t=s.find(t=>t.id===e))?void 0:t.name)||"تصنيف غير معروف",r=f[e];return(0,i.jsxs)("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[(0,i.jsx)("div",{className:"bg-gray-50 p-4 border-b",children:(0,i.jsx)("h3",{className:"text-lg font-semibold",children:a})}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الصنف"}),(0,i.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الكمية المتوفرة"}),(0,i.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الوحدة"}),(0,i.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"سعر الوحدة"}),(0,i.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"آخر تحديث"}),(0,i.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراءات"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(e=>(0,i.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(e.quantity<=5?"bg-red-50":""),children:[(0,i.jsx)("td",{className:"px-4 py-4",children:e.items.name}),(0,i.jsx)("td",{className:"px-4 py-4",children:(0,i.jsx)("span",{className:e.quantity<=5?"font-bold text-red-600":"",children:e.quantity})}),(0,i.jsx)("td",{className:"px-4 py-4",children:e.items.unit}),(0,i.jsx)("td",{className:"px-4 py-4",children:e.unit_price?"".concat(e.unit_price," ريال"):"غير محدد"}),(0,i.jsx)("td",{className:"px-4 py-4",dir:"ltr",children:new Date(e.last_updated).toLocaleDateString("ar-SA")}),(0,i.jsxs)("td",{className:"px-4 py-4 text-sm",children:[(0,i.jsx)(n(),{href:"/inventory/adjust/".concat(e.id),className:"text-primary hover:underline ml-2",children:"تعديل الكمية"}),(0,i.jsx)(n(),{href:"/inventory/history/".concat(e.items.id),className:"text-secondary hover:underline",children:"سجل الحركة"})]})]},e.id))})]})})]},e)})}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8",children:[(0,i.jsxs)("div",{className:"card bg-white",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-700",children:"إجمالي الأصناف"}),(0,i.jsx)("p",{className:"mt-2 text-3xl font-bold",children:e.length})]}),(0,i.jsxs)("div",{className:"card bg-white",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-700",children:"الأصناف منخفضة المخزون"}),(0,i.jsx)("p",{className:"mt-2 text-3xl font-bold",children:e.filter(e=>e.quantity<=5).length})]}),(0,i.jsxs)("div",{className:"card bg-white",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-700",children:"التصنيفات"}),(0,i.jsx)("p",{className:"mt-2 text-3xl font-bold",children:s.length})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,874,441,684,358],()=>t(4625)),_N_E=e.O()}]);