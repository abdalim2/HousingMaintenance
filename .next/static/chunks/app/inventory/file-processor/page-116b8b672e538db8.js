(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{2099:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});let a=(0,r(851).UU)("https://mticvmyfrdmciaeipfxu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10aWN2bXlmcmRtY2lhZWlwZnh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwODc1OTMsImV4cCI6MjA1NjY2MzU5M30.6iudxBl6js0heW1mhoSmcXegTIN_lAN2GiFeA3plSIo")},5239:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(5155),l=r(2115),d=r(6269);function s(){let[e,t]=(0,l.useState)(null),[r,s]=(0,l.useState)(""),[i,n]=(0,l.useState)([]),[c,o]=(0,l.useState)(!1),[m,g]=(0,l.useState)([]),[x,b]=(0,l.useState)(""),[u,h]=(0,l.useState)("upload"),[y,p]=(0,l.useState)(null),[N,k]=(0,l.useState)(-1);(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,d.bW)();g(e)}catch(e){console.error("Error loading categories:",e),b("Failed to load categories")}})()},[]);let f=async()=>{if(!r)return void b("يرجى تحميل ملف أولاً");o(!0),b("");try{let e=await fetch("/api/inventory/process-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:r})});if(!e.ok)throw Error("فشل في معالجة الملف");let t=await e.json();n(t.items),h("edit")}catch(e){console.error("Error processing file:",e),b("حدث خطأ أثناء معالجة الملف")}finally{o(!1)}},j=(e,t)=>{p({...e}),k(t)},v=e=>{let t=[...i];t.splice(e,1),n(t)};return(0,a.jsxs)("div",{className:"container mx-auto p-4 md:p-8 bg-gray-50 dark:bg-gray-900",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center dark:text-white",children:"معالج ملفات الأصناف"}),(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6 max-w-7xl mx-auto mb-8 dark:bg-gray-800",children:[(0,a.jsxs)("div",{className:"flex mb-6 border-b dark:border-gray-700",children:[(0,a.jsx)("button",{className:"px-4 py-2 ".concat("upload"===u?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),onClick:()=>h("upload"),children:"تحميل الملف"}),(0,a.jsx)("button",{className:"px-4 py-2 ".concat("edit"===u?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),onClick:()=>h("edit"),disabled:0===i.length,children:"تعديل الأصناف"})]}),"upload"===u&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"file-upload",className:"block text-lg font-medium mb-2 dark:text-white",children:"اختر ملف نصي يحتوي على الأصناف:"}),(0,a.jsx)("input",{id:"file-upload",type:"file",accept:".txt",onChange:e=>{var r;let a=null==(r=e.target.files)?void 0:r[0];if(a){t(a);let e=new FileReader;e.onload=e=>{var t;(null==(t=e.target)?void 0:t.result)&&s(e.target.result)},e.readAsText(a)}},className:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 dark:bg-gray-700 dark:border-gray-600 focus:outline-none p-2.5"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"يجب أن يحتوي الملف على اسم صنف واحد في كل سطر"})]}),r&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-2 dark:text-white",children:"محتوى الملف:"}),(0,a.jsx)("div",{className:"border rounded-md p-3 bg-gray-50 max-h-40 overflow-y-auto dark:bg-gray-700 dark:border-gray-600",children:(0,a.jsx)("pre",{className:"whitespace-pre-wrap dark:text-gray-300",children:r})})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("button",{onClick:f,disabled:!r||c,className:"w-full py-2.5 px-5 rounded-lg text-white font-medium \n                  ".concat(!r||c?"bg-blue-300 dark:bg-blue-800":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600"),children:c?"جاري المعالجة...":"معالجة الملف بالذكاء الاصطناعي"})})]}),"edit"===u&&i.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 dark:text-white",children:"قائمة الأصناف المثالية"}),y&&(0,a.jsxs)("div",{className:"mb-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-900/30 dark:border-blue-800",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4 dark:text-white",children:"تعديل الصنف"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 dark:text-gray-200",children:"الاسم بالعربية"}),(0,a.jsx)("input",{type:"text",value:y.arabicName,onChange:e=>p({...y,arabicName:e.target.value}),className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",dir:"rtl"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 dark:text-gray-200",children:"الاسم بالإنجليزية"}),(0,a.jsx)("input",{type:"text",value:y.englishName,onChange:e=>p({...y,englishName:e.target.value}),className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 dark:text-gray-200",children:"التصنيف"}),(0,a.jsx)("input",{type:"text",value:y.category,onChange:e=>p({...y,category:e.target.value}),className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",dir:"rtl"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 dark:text-gray-200",children:"الوحدة"}),(0,a.jsx)("input",{type:"text",value:y.unit,onChange:e=>p({...y,unit:e.target.value}),className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",dir:"rtl"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 dark:text-gray-200",children:"رابط الصورة"}),(0,a.jsx)("input",{type:"text",value:y.imageUrl,onChange:e=>p({...y,imageUrl:e.target.value}),className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)("div",{className:"h-24 w-24 relative bg-gray-100 dark:bg-gray-700 rounded",children:(0,a.jsx)("img",{src:y.imageUrl,alt:y.arabicName,className:"object-contain h-full w-full rounded"})})})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,a.jsx)("button",{onClick:()=>{if(!y||-1===N)return;let e=[...i];e[N]=y,n(e),p(null),k(-1)},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600",children:"حفظ التغييرات"}),(0,a.jsx)("button",{onClick:()=>{p(null),k(-1)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"إلغاء"})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm text-right text-gray-700 dark:text-gray-300",children:[(0,a.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-700 dark:text-gray-300",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3",children:"الصورة"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"الاسم العربي"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"الاسم الإنجليزي"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"التصنيف"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"الوحدة"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"الإجراءات"})]})}),(0,a.jsx)("tbody",{children:i.map((e,t)=>(0,a.jsxs)("tr",{className:"bg-white border-b hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("div",{className:"h-16 w-16 relative bg-gray-100 dark:bg-gray-700 rounded",children:(0,a.jsx)("img",{src:e.imageUrl,alt:e.arabicName,className:"object-contain h-full w-full rounded"})})}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.arabicName}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.englishName}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.category}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.unit}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>j(e,t),className:"p-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-300 dark:hover:bg-blue-800",children:"تعديل"}),(0,a.jsx)("button",{onClick:()=>v(t),className:"p-1 bg-red-100 text-red-700 rounded hover:bg-red-200 dark:bg-red-900 dark:text-red-300 dark:hover:bg-red-800",children:"حذف"})]})})]},t))})]})}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{onClick:()=>{if(0===i.length)return void b("لا توجد أصناف معالجة للتحميل");let e=new Blob([["الاسم العربي,الاسم الإنجليزي,التصنيف,الوحدة,رابط الصورة",...i.map(e=>'"'.concat(e.arabicName,'","').concat(e.englishName,'","').concat(e.category,'","').concat(e.unit,'","').concat(e.imageUrl,'"'))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download","processed_items.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},className:"w-full py-2.5 px-5 rounded-lg text-white font-medium bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600",children:"تحميل قائمة الأصناف المثالية (CSV)"})})]}),x&&(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mt-6 dark:bg-red-900/30 dark:border-red-800 dark:text-red-400",children:x})]})]})}},6269:(e,t,r)=>{"use strict";r.d(t,{JS:()=>n,K7:()=>i,ZK:()=>c,bW:()=>l,d2:()=>m,st:()=>s,x8:()=>o,zZ:()=>d});var a=r(2099);let l=async()=>{let{data:e,error:t}=await a.N.from("categories").select("*");if(t)throw t;return e||[]},d=async e=>{let{data:t,error:r}=await a.N.from("categories").insert([e]).select().single();if(r)throw r;return t},s=async(e,t)=>{let{data:r,error:l}=await a.N.from("categories").update(t).eq("id",e).select().single();if(l)throw l;return r},i=async e=>{let{error:t}=await a.N.from("categories").delete().eq("id",e);if(t)throw t},n=async e=>{let t=a.N.from("items").select("*");e&&(t=t.eq("category_id",e));let{data:r,error:l}=await t;if(l)throw l;return r||[]},c=async e=>{let t=a.N.from("inventory").select("\n      *,\n      items:item_id (\n        id,\n        name,\n        category_id,\n        unit\n      )\n    ");e&&(t=t.eq("item_id",e));let{data:r,error:l}=await t;if(l)throw l;return r||[]},o=async(e,t)=>{let{data:r,error:l}=await a.N.from("inventory").select("*").eq("item_id",e).single();if(l&&"PGRST116"!==l.code)throw l;if(r){let e=r.quantity+t;if(e<0)throw Error("Insufficient inventory quantity");let{data:l,error:d}=await a.N.from("inventory").update({quantity:e,last_updated:new Date().toISOString()}).eq("id",r.id).select().single();if(d)throw d;return l}if(t>0){let{data:r,error:l}=await a.N.from("inventory").insert([{item_id:e,quantity:t,last_updated:new Date().toISOString()}]).select().single();if(l)throw l;return r}throw Error("Cannot reduce quantity of non-existent inventory item")},m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,{data:t,error:r}=await a.N.from("inventory").select("\n      *,\n      items:item_id (\n        id,\n        name,\n        category_id,\n        unit\n      )\n    ").lte("quantity",e);if(r)throw r;return t||[]}},7580:(e,t,r)=>{Promise.resolve().then(r.bind(r,5239))}},e=>{var t=t=>e(e.s=t);e.O(0,[851,441,684,358],()=>t(7580)),_N_E=e.O()}]);