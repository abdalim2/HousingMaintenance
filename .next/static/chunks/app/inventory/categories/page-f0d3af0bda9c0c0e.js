(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[562],{271:(e,t,i)=>{Promise.resolve().then(i.bind(i,9916))},2099:(e,t,i)=>{"use strict";i.d(t,{N:()=>s});let s=(0,i(851).UU)("https://mticvmyfrdmciaeipfxu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10aWN2bXlmcmRtY2lhZWlwZnh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwODc1OTMsImV4cCI6MjA1NjY2MzU5M30.6iudxBl6js0heW1mhoSmcXegTIN_lAN2GiFeA3plSIo")},6269:(e,t,i)=>{"use strict";i.d(t,{JS:()=>c,K7:()=>l,ZK:()=>d,bW:()=>a,d2:()=>m,st:()=>n,x8:()=>o,zZ:()=>r});var s=i(2099);let a=async()=>{let{data:e,error:t}=await s.N.from("categories").select("*");if(t)throw t;return e||[]},r=async e=>{let{data:t,error:i}=await s.N.from("categories").insert([e]).select().single();if(i)throw i;return t},n=async(e,t)=>{let{data:i,error:a}=await s.N.from("categories").update(t).eq("id",e).select().single();if(a)throw a;return i},l=async e=>{let{error:t}=await s.N.from("categories").delete().eq("id",e);if(t)throw t},c=async e=>{let t=s.N.from("items").select("*");e&&(t=t.eq("category_id",e));let{data:i,error:a}=await t;if(a)throw a;return i||[]},d=async e=>{let t=s.N.from("inventory").select("\n      *,\n      items:item_id (\n        id,\n        name,\n        category_id,\n        unit\n      )\n    ");e&&(t=t.eq("item_id",e));let{data:i,error:a}=await t;if(a)throw a;return i||[]},o=async(e,t)=>{let{data:i,error:a}=await s.N.from("inventory").select("*").eq("item_id",e).single();if(a&&"PGRST116"!==a.code)throw a;if(i){let e=i.quantity+t;if(e<0)throw Error("Insufficient inventory quantity");let{data:a,error:r}=await s.N.from("inventory").update({quantity:e,last_updated:new Date().toISOString()}).eq("id",i.id).select().single();if(r)throw r;return a}if(t>0){let{data:i,error:a}=await s.N.from("inventory").insert([{item_id:e,quantity:t,last_updated:new Date().toISOString()}]).select().single();if(a)throw a;return i}throw Error("Cannot reduce quantity of non-existent inventory item")},m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,{data:t,error:i}=await s.N.from("inventory").select("\n      *,\n      items:item_id (\n        id,\n        name,\n        category_id,\n        unit\n      )\n    ").lte("quantity",e);if(i)throw i;return t||[]}},9916:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var s=i(5155),a=i(2115),r=i(6874),n=i.n(r),l=i(6269);function c(){let[e,t]=(0,a.useState)([]),[i,r]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),[o,m]=(0,a.useState)(null),[h,x]=(0,a.useState)({}),[u,p]=(0,a.useState)(!1),[y,g]=(0,a.useState)(null),[f,N]=(0,a.useState)(""),[b,w]=(0,a.useState)(""),j=async()=>{r(!0),d(null);try{let e=await (0,l.bW)();t(e);let i={};for(let t of e){let e=await (0,l.JS)(t.id);i[t.id]=e.length}x(i)}catch(e){console.error("Error fetching categories:",e),d("حدث خطأ أثناء تحميل التصنيفات. الرجاء المحاولة مرة أخرى.")}finally{r(!1)}};(0,a.useEffect)(()=>{j()},[]);let v=()=>{p(!1),g(null),N(""),w("")},S=async e=>{if(e.preventDefault(),!f.trim())return void d("اسم التصنيف مطلوب");d(null),m(null);try{u&&y?(await (0,l.st)(y,{name:f,description:b||void 0}),m("تم تحديث التصنيف بنجاح")):(await (0,l.zZ)({name:f,description:b||void 0}),m("تم إنشاء التصنيف بنجاح")),v(),await j()}catch(e){console.error("Error saving category:",e),d("حدث خطأ أثناء حفظ التصنيف. الرجاء المحاولة مرة أخرى.")}},I=e=>{p(!0),g(e.id),N(e.name),w(e.description||"")},_=async e=>{if(confirm("هل أنت متأكد من حذف هذا التصنيف؟ سيتم حذف جميع الأصناف المرتبطة به.")){d(null),m(null);try{await (0,l.K7)(e),m("تم حذف التصنيف بنجاح"),v(),await j()}catch(e){console.error("Error deleting category:",e),d("حدث خطأ أثناء حذف التصنيف. الرجاء المحاولة مرة أخرى.")}}};return(0,s.jsxs)("div",{className:"container mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"إدارة الأصناف"}),(0,s.jsx)(n(),{href:"/inventory",className:"btn btn-secondary",children:"العودة للمخزون"})]}),c&&(0,s.jsx)("div",{className:"bg-red-100 border-r-4 border-red-500 text-red-700 p-4 mb-6 rounded-md",children:(0,s.jsx)("p",{children:c})}),o&&(0,s.jsx)("div",{className:"bg-green-100 border-r-4 border-green-500 text-green-700 p-4 mb-6 rounded-md",children:(0,s.jsx)("p",{children:o})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"md:col-span-1",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:u?"تعديل التصنيف":"إضافة تصنيف جديد"}),(0,s.jsxs)("form",{onSubmit:S,children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"اسم التصنيف"}),(0,s.jsx)("input",{type:"text",value:f,onChange:e=>N(e.target.value),className:"input w-full",required:!0})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"الوصف (اختياري)"}),(0,s.jsx)("textarea",{value:b,onChange:e=>w(e.target.value),className:"input w-full h-24",placeholder:"وصف اختياري للتصنيف..."})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("button",{type:"submit",className:"btn btn-primary",children:u?"تحديث":"إضافة"}),u&&(0,s.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:v,children:"إلغاء"})]})]})]})}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,s.jsx)("div",{className:"p-4 bg-gray-50 border-b",children:(0,s.jsx)("h2",{className:"font-semibold text-lg",children:"قائمة التصنيفات"})}),i?(0,s.jsx)("div",{className:"text-center py-10",children:(0,s.jsx)("p",{className:"text-lg",children:"جاري تحميل البيانات..."})}):0===e.length?(0,s.jsx)("div",{className:"text-center py-10",children:(0,s.jsx)("p",{className:"text-lg text-gray-500",children:"لا توجد تصنيفات بعد. قم بإنشاء تصنيف جديد."})}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"التصنيف"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الوصف"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"عدد الأصناف"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراءات"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap font-medium",children:e.name}),(0,s.jsx)("td",{className:"px-4 py-4",children:e.description||"لا يوجد وصف"}),(0,s.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:h[e.id]||0}),(0,s.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:[(0,s.jsx)("button",{onClick:()=>I(e),className:"text-blue-600 hover:text-blue-900 ml-3",children:"تعديل"}),(0,s.jsx)("button",{onClick:()=>_(e.id),className:"text-red-600 hover:text-red-900",disabled:h[e.id]>0,title:h[e.id]>0?"لا يمكن حذف تصنيف يحتوي على أصناف":"حذف التصنيف",children:"حذف"})]})]},e.id))})]})})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,874,441,684,358],()=>t(271)),_N_E=e.O()}]);