(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{1112:(e,t,i)=>{Promise.resolve().then(i.bind(i,3191))},2099:(e,t,i)=>{"use strict";i.d(t,{N:()=>n});let n=(0,i(851).UU)("https://mticvmyfrdmciaeipfxu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10aWN2bXlmcmRtY2lhZWlwZnh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwODc1OTMsImV4cCI6MjA1NjY2MzU5M30.6iudxBl6js0heW1mhoSmcXegTIN_lAN2GiFeA3plSIo")},3191:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(5155),r=i(2115),s=i(5695),a=i(6874),l=i.n(a),d=i(6269);function o(){let e=(0,s.useRouter)(),[t,i]=(0,r.useState)([]),[a,o]=(0,r.useState)([]),[c,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(!1),[f,b]=(0,r.useState)(null),[v,y]=(0,r.useState)(null),[p,x]=(0,r.useState)(""),[g,N]=(0,r.useState)(""),[w,j]=(0,r.useState)(1),[S,I]=(0,r.useState)(void 0);(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,d.bW)();i(e)}catch(e){console.error("Error fetching categories:",e),b("حدث خطأ أثناء تحميل التصنيفات. الرجاء المحاولة مرة أخرى.")}finally{u(!1)}})()},[]),(0,r.useEffect)(()=>{if(!p)return void o([]);(async()=>{try{let e=await (0,d.JS)(p);o(e)}catch(e){console.error("Error fetching items:",e),b("حدث خطأ أثناء تحميل الأصناف. الرجاء المحاولة مرة أخرى.")}})()},[p]);let _=async t=>{if(t.preventDefault(),!g)return void b("الرجاء اختيار الصنف");if(w<=0)return void b("الرجاء إدخال كمية صحيحة");h(!0),b(null),y(null);try{await (0,d.x8)(g,w),a.find(e=>e.id===g)&&S&&S>0&&await fetch("/api/inventory/update-price",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemId:g,unitPrice:S})}),y("تمت إضافة المخزون بنجاح"),N(""),j(1),I(void 0),setTimeout(()=>{e.push("/inventory")},2e3)}catch(e){console.error("Error updating inventory:",e),b("حدث خطأ أثناء إضافة المخزون. الرجاء المحاولة مرة أخرى.")}finally{h(!1)}};return(0,n.jsxs)("div",{className:"container mx-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"إضافة مخزون"}),(0,n.jsx)(l(),{href:"/inventory",className:"btn btn-secondary",children:"العودة للمخزون"})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[f&&(0,n.jsx)("div",{className:"bg-red-100 border-r-4 border-red-500 text-red-700 p-4 mb-6 rounded-md",children:(0,n.jsx)("p",{children:f})}),v&&(0,n.jsx)("div",{className:"bg-green-100 border-r-4 border-green-500 text-green-700 p-4 mb-6 rounded-md",children:(0,n.jsx)("p",{children:v})}),(0,n.jsxs)("form",{onSubmit:_,children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"التصنيف"}),(0,n.jsxs)("select",{value:p,onChange:e=>{x(e.target.value),N("")},className:"select w-full",disabled:c||m,required:!0,children:[(0,n.jsx)("option",{value:"",children:"اختر التصنيف"}),t.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"الصنف"}),(0,n.jsxs)("select",{value:g,onChange:e=>N(e.target.value),className:"select w-full",disabled:!p||c||m,required:!0,children:[(0,n.jsx)("option",{value:"",children:"اختر الصنف"}),a.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.name," (",e.unit,")"]},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"الكمية"}),(0,n.jsx)("input",{type:"number",value:w,onChange:e=>j(Number(e.target.value)),min:"1",className:"input w-full",disabled:m,required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"سعر الوحدة (اختياري)"}),(0,n.jsx)("input",{type:"number",value:void 0===S?"":S,onChange:e=>{I(""===e.target.value?void 0:Number(e.target.value))},min:"0",step:"0.01",className:"input w-full",disabled:m,placeholder:"أدخل سعر الوحدة بالريال"})]})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:m||!g,children:m?"جاري الإضافة...":"إضافة للمخزون"})})]})]})]})}},5695:(e,t,i)=>{"use strict";var n=i(8999);i.o(n,"usePathname")&&i.d(t,{usePathname:function(){return n.usePathname}}),i.o(n,"useRouter")&&i.d(t,{useRouter:function(){return n.useRouter}})},6269:(e,t,i)=>{"use strict";i.d(t,{JS:()=>d,K7:()=>l,ZK:()=>o,bW:()=>r,d2:()=>u,st:()=>a,x8:()=>c,zZ:()=>s});var n=i(2099);let r=async()=>{let{data:e,error:t}=await n.N.from("categories").select("*");if(t)throw t;return e||[]},s=async e=>{let{data:t,error:i}=await n.N.from("categories").insert([e]).select().single();if(i)throw i;return t},a=async(e,t)=>{let{data:i,error:r}=await n.N.from("categories").update(t).eq("id",e).select().single();if(r)throw r;return i},l=async e=>{let{error:t}=await n.N.from("categories").delete().eq("id",e);if(t)throw t},d=async e=>{let t=n.N.from("items").select("*");e&&(t=t.eq("category_id",e));let{data:i,error:r}=await t;if(r)throw r;return i||[]},o=async e=>{let t=n.N.from("inventory").select("\n      *,\n      items:item_id (\n        id,\n        name,\n        category_id,\n        unit\n      )\n    ");e&&(t=t.eq("item_id",e));let{data:i,error:r}=await t;if(r)throw r;return i||[]},c=async(e,t)=>{let{data:i,error:r}=await n.N.from("inventory").select("*").eq("item_id",e).single();if(r&&"PGRST116"!==r.code)throw r;if(i){let e=i.quantity+t;if(e<0)throw Error("Insufficient inventory quantity");let{data:r,error:s}=await n.N.from("inventory").update({quantity:e,last_updated:new Date().toISOString()}).eq("id",i.id).select().single();if(s)throw s;return r}if(t>0){let{data:i,error:r}=await n.N.from("inventory").insert([{item_id:e,quantity:t,last_updated:new Date().toISOString()}]).select().single();if(r)throw r;return i}throw Error("Cannot reduce quantity of non-existent inventory item")},u=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,{data:t,error:i}=await n.N.from("inventory").select("\n      *,\n      items:item_id (\n        id,\n        name,\n        category_id,\n        unit\n      )\n    ").lte("quantity",e);if(i)throw i;return t||[]}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,874,441,684,358],()=>t(1112)),_N_E=e.O()}]);