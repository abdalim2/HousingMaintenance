{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/src/app/inventory/add/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { getCategories, getItems, updateInventoryQuantity } from '@/lib/services/inventoryService';\r\nimport { Category, Item } from '@/models/types';\r\n\r\nexport default function AddInventoryPage() {\r\n  const router = useRouter();\r\n  const [categories, setCategories] = useState<Category[]>([]);\r\n  const [items, setItems] = useState<Item[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n\r\n  // Form state\r\n  const [selectedCategoryId, setSelectedCategoryId] = useState<string>('');\r\n  const [selectedItemId, setSelectedItemId] = useState<string>('');\r\n  const [quantity, setQuantity] = useState<number>(1);\r\n  const [unitPrice, setUnitPrice] = useState<number | undefined>(undefined);\r\n\r\n  // Load categories and items\r\n  useEffect(() => {\r\n    const fetchCategories = async () => {\r\n      try {\r\n        const categoriesData = await getCategories();\r\n        setCategories(categoriesData);\r\n      } catch (err) {\r\n        console.error('Error fetching categories:', err);\r\n        setError('حدث خطأ أثناء تحميل التصنيفات. الرجاء المحاولة مرة أخرى.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchCategories();\r\n  }, []);\r\n\r\n  // Load items when category changes\r\n  useEffect(() => {\r\n    if (!selectedCategoryId) {\r\n      setItems([]);\r\n      return;\r\n    }\r\n\r\n    const fetchItems = async () => {\r\n      try {\r\n        const itemsData = await getItems(selectedCategoryId);\r\n        setItems(itemsData);\r\n      } catch (err) {\r\n        console.error('Error fetching items:', err);\r\n        setError('حدث خطأ أثناء تحميل الأصناف. الرجاء المحاولة مرة أخرى.');\r\n      }\r\n    };\r\n\r\n    fetchItems();\r\n  }, [selectedCategoryId]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!selectedItemId) {\r\n      setError('الرجاء اختيار الصنف');\r\n      return;\r\n    }\r\n\r\n    if (quantity <= 0) {\r\n      setError('الرجاء إدخال كمية صحيحة');\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    setError(null);\r\n    setSuccess(null);\r\n    \r\n    try {\r\n      await updateInventoryQuantity(selectedItemId, quantity);\r\n      \r\n      const selectedItem = items.find(item => item.id === selectedItemId);\r\n      \r\n      // Update unit price if provided\r\n      if (selectedItem && unitPrice && unitPrice > 0) {\r\n        // Note: This is a simplified update - in a real implementation, \r\n        // you would add price history tracking and maintain price consistency\r\n        await fetch(`/api/inventory/update-price`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({\r\n            itemId: selectedItemId,\r\n            unitPrice: unitPrice\r\n          }),\r\n        });\r\n      }\r\n      \r\n      setSuccess('تمت إضافة المخزون بنجاح');\r\n      \r\n      // Reset form\r\n      setSelectedItemId('');\r\n      setQuantity(1);\r\n      setUnitPrice(undefined);\r\n      \r\n      // Redirect after a short delay\r\n      setTimeout(() => {\r\n        router.push('/inventory');\r\n      }, 2000);\r\n    } catch (err) {\r\n      console.error('Error updating inventory:', err);\r\n      setError('حدث خطأ أثناء إضافة المخزون. الرجاء المحاولة مرة أخرى.');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-bold\">إضافة مخزون</h1>\r\n        <Link href=\"/inventory\" className=\"btn btn-secondary\">\r\n          العودة للمخزون\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"bg-white rounded-lg shadow p-6\">\r\n        {error && (\r\n          <div className=\"bg-red-100 border-r-4 border-red-500 text-red-700 p-4 mb-6 rounded-md\">\r\n            <p>{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {success && (\r\n          <div className=\"bg-green-100 border-r-4 border-green-500 text-green-700 p-4 mb-6 rounded-md\">\r\n            <p>{success}</p>\r\n          </div>\r\n        )}\r\n\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">التصنيف</label>\r\n              <select\r\n                value={selectedCategoryId}\r\n                onChange={(e) => {\r\n                  setSelectedCategoryId(e.target.value);\r\n                  setSelectedItemId(''); // Reset selected item when category changes\r\n                }}\r\n                className=\"select w-full\"\r\n                disabled={loading || submitting}\r\n                required\r\n              >\r\n                <option value=\"\">اختر التصنيف</option>\r\n                {categories.map(category => (\r\n                  <option key={category.id} value={category.id}>\r\n                    {category.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">الصنف</label>\r\n              <select\r\n                value={selectedItemId}\r\n                onChange={(e) => setSelectedItemId(e.target.value)}\r\n                className=\"select w-full\"\r\n                disabled={!selectedCategoryId || loading || submitting}\r\n                required\r\n              >\r\n                <option value=\"\">اختر الصنف</option>\r\n                {items.map(item => (\r\n                  <option key={item.id} value={item.id}>\r\n                    {item.name} ({item.unit})\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">الكمية</label>\r\n              <input\r\n                type=\"number\"\r\n                value={quantity}\r\n                onChange={(e) => setQuantity(Number(e.target.value))}\r\n                min=\"1\"\r\n                className=\"input w-full\"\r\n                disabled={submitting}\r\n                required\r\n              />\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block mb-2 text-sm font-medium\">سعر الوحدة (اختياري)</label>\r\n              <input\r\n                type=\"number\"\r\n                value={unitPrice === undefined ? '' : unitPrice}\r\n                onChange={(e) => {\r\n                  const value = e.target.value === '' ? undefined : Number(e.target.value);\r\n                  setUnitPrice(value);\r\n                }}\r\n                min=\"0\"\r\n                step=\"0.01\"\r\n                className=\"input w-full\"\r\n                disabled={submitting}\r\n                placeholder=\"أدخل سعر الوحدة بالريال\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex justify-end\">\r\n            <button\r\n              type=\"submit\"\r\n              className=\"btn btn-primary\"\r\n              disabled={submitting || !selectedItemId}\r\n            >\r\n              {submitting ? 'جاري الإضافة...' : 'إضافة للمخزون'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}