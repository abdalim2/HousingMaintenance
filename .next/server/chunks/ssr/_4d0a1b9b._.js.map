{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/src/lib/neondb.ts"],"sourcesContent":["'use server';\r\n\r\nimport { Pool } from 'pg';\r\n\r\n// استخدام عنوان الاتصال المباشر بقاعدة بيانات Neon\r\nconst connectionString = 'postgresql://HousingMaintenance_owner:npg_fC8S4bpZLsJw@ep-weathered-meadow-a44a1v3i-pooler.us-east-1.aws.neon.tech/HousingMaintenance?sslmode=require';\r\n\r\n// إنشاء تجمع اتصالات لقاعدة البيانات\r\nexport const pool = new Pool({\r\n  connectionString,\r\n  max: 20, // زيادة عدد الاتصالات المتزامنة\r\n  idleTimeoutMillis: 30000, // وقت انتظار أطول\r\n  connectionTimeoutMillis: 5000, // مهلة اتصال أقصر\r\n});\r\n\r\n// وظيفة مساعدة لتنفيذ استعلامات قاعدة البيانات مع إعادة المحاولة\r\nexport async function query(text: string, params?: any[], retries = 3) {\r\n  let lastError;\r\n  for (let attempt = 0; attempt < retries; attempt++) {\r\n    const client = await pool.connect().catch(err => {\r\n      console.error(`فشل الاتصال بقاعدة البيانات (محاولة ${attempt + 1}/${retries}):`, err.message);\r\n      return null;\r\n    });\r\n    \r\n    if (!client) {\r\n      lastError = new Error('تعذر إنشاء اتصال بقاعدة البيانات');\r\n      continue;\r\n    }\r\n    \r\n    try {\r\n      const result = await client.query(text, params);\r\n      return result;\r\n    } catch (error: any) {\r\n      lastError = error;\r\n      console.error(`فشل الاستعلام (محاولة ${attempt + 1}/${retries}):`, error.message);\r\n    } finally {\r\n      client.release();\r\n    }\r\n  }\r\n  \r\n  // إذا وصلنا إلى هنا، فقد فشلت جميع المحاولات\r\n  throw lastError || new Error('فشل الاستعلام بعد عدة محاولات');\r\n}\r\n\r\n// التحقق من اتصال قاعدة البيانات\r\nexport async function testConnection() {\r\n  try {\r\n    const result = await query('SELECT NOW()', [], 1);\r\n    console.log('اتصال ناجح بقاعدة بيانات Neon:', result.rows[0]);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('فشل الاتصال بقاعدة بيانات Neon:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// وظيفة مساعدة للحصول على بيانات آمنة\r\nexport async function safeQuery(text: string, params?: any[], defaultValue: any = []) {\r\n  try {\r\n    const result = await query(text, params);\r\n    return result.rows || defaultValue;\r\n  } catch (error) {\r\n    console.error('فشل الاستعلام، استخدام القيمة الافتراضية:', error);\r\n    return defaultValue;\r\n  }\r\n}"],"names":[],"mappings":";;;;;;IAgBsB,QAAA,WAAA,GAAA,CAAA,GAAA,sNAAA,CAAA,wBAAA,EAAA,8CAAA,sNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,sNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/src/lib/neondb.ts"],"sourcesContent":["'use server';\r\n\r\nimport { Pool } from 'pg';\r\n\r\n// استخدام عنوان الاتصال المباشر بقاعدة بيانات Neon\r\nconst connectionString = 'postgresql://HousingMaintenance_owner:npg_fC8S4bpZLsJw@ep-weathered-meadow-a44a1v3i-pooler.us-east-1.aws.neon.tech/HousingMaintenance?sslmode=require';\r\n\r\n// إنشاء تجمع اتصالات لقاعدة البيانات\r\nexport const pool = new Pool({\r\n  connectionString,\r\n  max: 20, // زيادة عدد الاتصالات المتزامنة\r\n  idleTimeoutMillis: 30000, // وقت انتظار أطول\r\n  connectionTimeoutMillis: 5000, // مهلة اتصال أقصر\r\n});\r\n\r\n// وظيفة مساعدة لتنفيذ استعلامات قاعدة البيانات مع إعادة المحاولة\r\nexport async function query(text: string, params?: any[], retries = 3) {\r\n  let lastError;\r\n  for (let attempt = 0; attempt < retries; attempt++) {\r\n    const client = await pool.connect().catch(err => {\r\n      console.error(`فشل الاتصال بقاعدة البيانات (محاولة ${attempt + 1}/${retries}):`, err.message);\r\n      return null;\r\n    });\r\n    \r\n    if (!client) {\r\n      lastError = new Error('تعذر إنشاء اتصال بقاعدة البيانات');\r\n      continue;\r\n    }\r\n    \r\n    try {\r\n      const result = await client.query(text, params);\r\n      return result;\r\n    } catch (error: any) {\r\n      lastError = error;\r\n      console.error(`فشل الاستعلام (محاولة ${attempt + 1}/${retries}):`, error.message);\r\n    } finally {\r\n      client.release();\r\n    }\r\n  }\r\n  \r\n  // إذا وصلنا إلى هنا، فقد فشلت جميع المحاولات\r\n  throw lastError || new Error('فشل الاستعلام بعد عدة محاولات');\r\n}\r\n\r\n// التحقق من اتصال قاعدة البيانات\r\nexport async function testConnection() {\r\n  try {\r\n    const result = await query('SELECT NOW()', [], 1);\r\n    console.log('اتصال ناجح بقاعدة بيانات Neon:', result.rows[0]);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('فشل الاتصال بقاعدة بيانات Neon:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// وظيفة مساعدة للحصول على بيانات آمنة\r\nexport async function safeQuery(text: string, params?: any[], defaultValue: any = []) {\r\n  try {\r\n    const result = await query(text, params);\r\n    return result.rows || defaultValue;\r\n  } catch (error) {\r\n    console.error('فشل الاستعلام، استخدام القيمة الافتراضية:', error);\r\n    return defaultValue;\r\n  }\r\n}"],"names":[],"mappings":";;;;;;IAyDsB,YAAA,WAAA,GAAA,CAAA,GAAA,sNAAA,CAAA,wBAAA,EAAA,8CAAA,sNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,sNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/src/lib/services/purchaseService.ts"],"sourcesContent":["import { query, safeQuery } from '../neondb';\r\nimport { PurchaseOrder, PurchaseItem } from '@/models/types';\r\n\r\n// Purchase Order Operations\r\nexport const getPurchaseOrders = async (\r\n  status?: PurchaseOrder['status']\r\n): Promise<PurchaseOrder[]> => {\r\n  try {\r\n    let sql = 'SELECT * FROM purchase_orders WHERE 1=1';\r\n    const params: any[] = [];\r\n    \r\n    if (status) {\r\n      params.push(status);\r\n      sql += ` AND status = $${params.length}`;\r\n    }\r\n    \r\n    sql += ' ORDER BY order_date DESC';\r\n    \r\n    return await safeQuery(sql, params, []);\r\n  } catch (err) {\r\n    console.error('Error in getPurchaseOrders:', err);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const getPurchaseOrderById = async (id: string): Promise<PurchaseOrder | null> => {\r\n  try {\r\n    const result = await query('SELECT * FROM purchase_orders WHERE id = $1', [id]);\r\n    return result.rows[0] || null;\r\n  } catch (err) {\r\n    console.error('Error in getPurchaseOrderById:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport const createPurchaseOrder = async (\r\n  order: Omit<PurchaseOrder, 'id' | 'order_date'>\r\n): Promise<PurchaseOrder> => {\r\n  try {\r\n    const newOrder = {\r\n      ...order,\r\n      order_date: new Date().toISOString(),\r\n      status: order.status || 'draft'\r\n    };\r\n    \r\n    const fields = Object.keys(newOrder).join(', ');\r\n    const placeholders = Object.keys(newOrder).map((_, i) => `$${i + 1}`).join(', ');\r\n    const values = Object.values(newOrder);\r\n    \r\n    const sql = `\r\n      INSERT INTO purchase_orders (${fields}) \r\n      VALUES (${placeholders})\r\n      RETURNING *\r\n    `;\r\n    \r\n    const result = await query(sql, values);\r\n    return result.rows[0];\r\n  } catch (err) {\r\n    console.error('Error in createPurchaseOrder:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport const updatePurchaseOrder = async (\r\n  id: string, \r\n  updates: Partial<PurchaseOrder>\r\n): Promise<PurchaseOrder> => {\r\n  try {\r\n    const fields = Object.keys(updates);\r\n    const setClause = fields.map((field, i) => `${field} = $${i + 1}`).join(', ');\r\n    const values = [...Object.values(updates), id];\r\n    \r\n    const sql = `\r\n      UPDATE purchase_orders \r\n      SET ${setClause} \r\n      WHERE id = $${fields.length + 1}\r\n      RETURNING *\r\n    `;\r\n    \r\n    const result = await query(sql, values);\r\n    return result.rows[0];\r\n  } catch (err) {\r\n    console.error('Error in updatePurchaseOrder:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport const deletePurchaseOrder = async (id: string): Promise<void> => {\r\n  try {\r\n    await query('DELETE FROM purchase_orders WHERE id = $1', [id]);\r\n  } catch (err) {\r\n    console.error('Error in deletePurchaseOrder:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\n// Purchase Items Operations\r\nexport const getPurchaseItems = async (\r\n  purchaseOrderId: string\r\n): Promise<PurchaseItem[]> => {\r\n  try {\r\n    const sql = `\r\n      SELECT pi.*, \r\n             i.id as item_id, \r\n             i.name as item_name, \r\n             i.category_id, \r\n             i.unit\r\n      FROM purchase_items pi\r\n      LEFT JOIN items i ON pi.item_id = i.id\r\n      WHERE pi.purchase_order_id = $1\r\n    `;\r\n    \r\n    const result = await query(sql, [purchaseOrderId]);\r\n    \r\n    // Format the result to match the expected structure\r\n    return result.rows.map(row => ({\r\n      ...row,\r\n      items: {\r\n        id: row.item_id,\r\n        name: row.item_name,\r\n        category_id: row.category_id,\r\n        unit: row.unit\r\n      }\r\n    }));\r\n  } catch (err) {\r\n    console.error('Error in getPurchaseItems:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport const getPurchaseItemById = async (id: string): Promise<PurchaseItem | null> => {\r\n  try {\r\n    const sql = `\r\n      SELECT pi.*, \r\n             i.id as item_id, \r\n             i.name as item_name, \r\n             i.category_id, \r\n             i.unit\r\n      FROM purchase_items pi\r\n      LEFT JOIN items i ON pi.item_id = i.id\r\n      WHERE pi.id = $1\r\n    `;\r\n    \r\n    const result = await query(sql, [id]);\r\n    \r\n    if (result.rows.length === 0) {\r\n      return null;\r\n    }\r\n    \r\n    // Format the result to match the expected structure\r\n    const row = result.rows[0];\r\n    return {\r\n      ...row,\r\n      items: {\r\n        id: row.item_id,\r\n        name: row.item_name,\r\n        category_id: row.category_id,\r\n        unit: row.unit\r\n      }\r\n    };\r\n  } catch (err) {\r\n    console.error('Error in getPurchaseItemById:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport const createPurchaseItem = async (\r\n  item: Omit<PurchaseItem, 'id'>\r\n): Promise<PurchaseItem> => {\r\n  try {\r\n    const fields = Object.keys(item).join(', ');\r\n    const placeholders = Object.keys(item).map((_, i) => `$${i + 1}`).join(', ');\r\n    const values = Object.values(item);\r\n    \r\n    const sql = `\r\n      INSERT INTO purchase_items (${fields}) \r\n      VALUES (${placeholders})\r\n      RETURNING *\r\n    `;\r\n    \r\n    const result = await query(sql, values);\r\n    return result.rows[0];\r\n  } catch (err) {\r\n    console.error('Error in createPurchaseItem:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport const updatePurchaseItem = async (\r\n  id: string, \r\n  updates: Partial<PurchaseItem>\r\n): Promise<PurchaseItem> => {\r\n  try {\r\n    const fields = Object.keys(updates);\r\n    const setClause = fields.map((field, i) => `${field} = $${i + 1}`).join(', ');\r\n    const values = [...Object.values(updates), id];\r\n    \r\n    const sql = `\r\n      UPDATE purchase_items \r\n      SET ${setClause} \r\n      WHERE id = $${fields.length + 1}\r\n      RETURNING *\r\n    `;\r\n    \r\n    const result = await query(sql, values);\r\n    return result.rows[0];\r\n  } catch (err) {\r\n    console.error('Error in updatePurchaseItem:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport const deletePurchaseItem = async (id: string): Promise<void> => {\r\n  try {\r\n    await query('DELETE FROM purchase_items WHERE id = $1', [id]);\r\n  } catch (err) {\r\n    console.error('Error in deletePurchaseItem:', err);\r\n    throw err;\r\n  }\r\n};\r\n\r\n// Generate Monthly Purchase Orders\r\nexport const generateMonthlyPurchaseOrder = async (\r\n  year: number,\r\n  month: number,\r\n  createdBy: string\r\n): Promise<PurchaseOrder> => {\r\n  try {\r\n    // 1. Get all maintenance requests for the month\r\n    const startDate = new Date(year, month - 1, 1).toISOString();\r\n    const endDate = new Date(year, month, 0).toISOString();\r\n    \r\n    // Get all maintenance requests for the specified month first\r\n    let result;\r\n    try {\r\n      result = await query(\r\n        'SELECT id FROM maintenance_requests WHERE reported_date >= $1 AND reported_date <= $2',\r\n        [startDate, endDate]\r\n      );\r\n    } catch (err: any) {\r\n      // If the table doesn't exist, create a purchase order without items\r\n      if (err.message.includes('does not exist')) {\r\n        console.warn('Maintenance requests table does not exist yet. Creating empty purchase order.');\r\n        return createEmptyPurchaseOrder(year, month, createdBy);\r\n      }\r\n      throw err;\r\n    }\r\n    \r\n    const maintenanceRequests = result.rows;\r\n    \r\n    if (!maintenanceRequests || maintenanceRequests.length === 0) {\r\n      console.log('No maintenance requests found for the specified month. Creating empty purchase order.');\r\n      return createEmptyPurchaseOrder(year, month, createdBy);\r\n    }\r\n    \r\n    // Get maintenance items for these requests\r\n    const maintenanceIds = maintenanceRequests.map(req => req.id);\r\n    const placeholders = maintenanceIds.map((_, i) => `$${i + 1}`).join(',');\r\n    \r\n    let itemsResult;\r\n    try {\r\n      itemsResult = await query(\r\n        `SELECT * FROM maintenance_items WHERE maintenance_id IN (${placeholders})`,\r\n        maintenanceIds\r\n      );\r\n    } catch (err: any) {\r\n      // If the table doesn't exist, create a purchase order without items\r\n      if (err.message.includes('does not exist')) {\r\n        console.warn('Maintenance items table does not exist yet. Creating empty purchase order.');\r\n        return createEmptyPurchaseOrder(year, month, createdBy);\r\n      }\r\n      throw err;\r\n    }\r\n    \r\n    const maintenanceItems = itemsResult.rows;\r\n    \r\n    if (!maintenanceItems || maintenanceItems.length === 0) {\r\n      console.log('No maintenance items found for the specified month. Creating empty purchase order.');\r\n      return createEmptyPurchaseOrder(year, month, createdBy);\r\n    }\r\n    \r\n    // 2. Group items by item_id and sum quantities\r\n    const itemQuantities: Record<string, number> = {};\r\n    \r\n    maintenanceItems.forEach(item => {\r\n      if (!itemQuantities[item.item_id]) {\r\n        itemQuantities[item.item_id] = 0;\r\n      }\r\n      itemQuantities[item.item_id] += item.quantity_needed;\r\n    });\r\n    \r\n    // 3. Create a new purchase order\r\n    const newOrder = {\r\n      order_date: new Date().toISOString(),\r\n      status: 'draft',\r\n      created_by: createdBy,\r\n      notes: `Auto-generated order for ${year}-${month.toString().padStart(2, '0')}`\r\n    };\r\n    \r\n    const orderFields = Object.keys(newOrder).join(', ');\r\n    const orderPlaceholders = Object.keys(newOrder).map((_, i) => `$${i + 1}`).join(', ');\r\n    const orderValues = Object.values(newOrder);\r\n    \r\n    const orderResult = await query(\r\n      `INSERT INTO purchase_orders (${orderFields}) VALUES (${orderPlaceholders}) RETURNING *`,\r\n      orderValues\r\n    );\r\n    \r\n    const purchaseOrder = orderResult.rows[0];\r\n    \r\n    // 4. Create purchase items for each item type\r\n    if (Object.keys(itemQuantities).length > 0) {\r\n      const purchaseItems = Object.entries(itemQuantities).map(([itemId, quantity]) => ({\r\n        purchase_order_id: purchaseOrder.id,\r\n        item_id: itemId,\r\n        quantity: quantity\r\n      }));\r\n      \r\n      for (const item of purchaseItems) {\r\n        const itemFields = Object.keys(item).join(', ');\r\n        const itemPlaceholders = Object.keys(item).map((_, i) => `$${i + 1}`).join(', ');\r\n        const itemValues = Object.values(item);\r\n        \r\n        await query(\r\n          `INSERT INTO purchase_items (${itemFields}) VALUES (${itemPlaceholders})`,\r\n          itemValues\r\n        );\r\n      }\r\n    }\r\n    \r\n    return purchaseOrder;\r\n  } catch (error: any) {\r\n    console.error('Error generating monthly purchase order:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Helper function to create an empty purchase order when no maintenance items are found\r\nconst createEmptyPurchaseOrder = async (\r\n  year: number,\r\n  month: number,\r\n  createdBy: string\r\n): Promise<PurchaseOrder> => {\r\n  const newOrder = {\r\n    order_date: new Date().toISOString(),\r\n    status: 'draft',\r\n    created_by: createdBy,\r\n    notes: `Auto-generated order for ${year}-${month.toString().padStart(2, '0')} (No maintenance items found)`\r\n  };\r\n  \r\n  const fields = Object.keys(newOrder).join(', ');\r\n  const placeholders = Object.keys(newOrder).map((_, i) => `$${i + 1}`).join(', ');\r\n  const values = Object.values(newOrder);\r\n  \r\n  const result = await query(\r\n    `INSERT INTO purchase_orders (${fields}) VALUES (${placeholders}) RETURNING *`,\r\n    values\r\n  );\r\n  \r\n  return result.rows[0];\r\n};\r\n\r\n// Process Received Items\r\nexport const processReceivedItems = async (\r\n  purchaseOrderId: string, \r\n  receivedItems: Array<{ id: string, received_quantity: number }>\r\n): Promise<void> => {\r\n  try {\r\n    // Process each received item\r\n    for (const item of receivedItems) {\r\n      // 1. Update the purchase item\r\n      const updateItemResult = await query(\r\n        'UPDATE purchase_items SET received_quantity = $1 WHERE id = $2 RETURNING *',\r\n        [item.received_quantity, item.id]\r\n      );\r\n      \r\n      if (updateItemResult.rows.length === 0) {\r\n        throw new Error(`Purchase item with ID ${item.id} not found`);\r\n      }\r\n      \r\n      const purchaseItem = updateItemResult.rows[0];\r\n      \r\n      // 2. Update inventory\r\n      // First, get the current inventory for this item\r\n      const inventoryResult = await query(\r\n        'SELECT * FROM inventory WHERE item_id = $1',\r\n        [purchaseItem.item_id]\r\n      );\r\n      \r\n      const currentInventory = inventoryResult.rows[0];\r\n      \r\n      // If inventory entry exists, update it\r\n      if (currentInventory) {\r\n        await query(\r\n          'UPDATE inventory SET quantity = $1, last_updated = $2 WHERE id = $3',\r\n          [currentInventory.quantity + item.received_quantity, new Date().toISOString(), currentInventory.id]\r\n        );\r\n      } \r\n      // If no inventory entry exists, create one\r\n      else {\r\n        await query(\r\n          'INSERT INTO inventory (item_id, quantity, unit_price, last_updated) VALUES ($1, $2, $3, $4)',\r\n          [purchaseItem.item_id, item.received_quantity, purchaseItem.unit_price, new Date().toISOString()]\r\n        );\r\n      }\r\n    }\r\n    \r\n    // 3. Update the purchase order status to 'received'\r\n    await query(\r\n      'UPDATE purchase_orders SET status = $1 WHERE id = $2',\r\n      ['received', purchaseOrderId]\r\n    );\r\n  } catch (err) {\r\n    console.error('Error in processReceivedItems:', err);\r\n    throw err;\r\n  }\r\n};"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 390, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/src/app/purchase-orders/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { getPurchaseOrders } from '@/lib/services/purchaseService';\r\nimport { PurchaseOrder } from '@/models/types';\r\n\r\nexport default function PurchaseOrdersPage() {\r\n  const [purchaseOrders, setPurchaseOrders] = useState<PurchaseOrder[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Filter state\r\n  const [filterStatus, setFilterStatus] = useState<string>('');\r\n  const [dateRange, setDateRange] = useState<{start: string, end: string}>({\r\n    start: '',\r\n    end: ''\r\n  });\r\n\r\n  // Load purchase orders\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      try {\r\n        const orders = await getPurchaseOrders(\r\n          filterStatus as PurchaseOrder['status'] || undefined\r\n        );\r\n        setPurchaseOrders(orders);\r\n      } catch (err: any) {\r\n        console.error('Error fetching purchase orders:', err.message || JSON.stringify(err));\r\n        setError(`حدث خطأ أثناء تحميل طلبات الشراء: ${err.message || 'خطأ غير معروف'}. الرجاء المحاولة مرة أخرى.`);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [filterStatus]);\r\n\r\n  // Filter by date range\r\n  const filteredOrders = purchaseOrders.filter(order => {\r\n    let includeOrder = true;\r\n    \r\n    // Apply date filters if they exist\r\n    if (dateRange.start) {\r\n      includeOrder = includeOrder && new Date(order.order_date) >= new Date(dateRange.start);\r\n    }\r\n    \r\n    if (dateRange.end) {\r\n      includeOrder = includeOrder && new Date(order.order_date) <= new Date(dateRange.end);\r\n    }\r\n    \r\n    return includeOrder;\r\n  });\r\n\r\n  // Calculate statistics\r\n  const pendingCount = purchaseOrders.filter(order => \r\n    order.status === 'draft' || order.status === 'submitted'\r\n  ).length;\r\n  \r\n  const receivedCount = purchaseOrders.filter(order => \r\n    order.status === 'received'\r\n  ).length;\r\n  \r\n  const completedCount = purchaseOrders.filter(order => \r\n    order.status === 'completed'\r\n  ).length;\r\n\r\n  // Monthly purchase orders (group by month)\r\n  const currentDate = new Date();\r\n  const currentMonth = currentDate.getMonth();\r\n  const currentYear = currentDate.getFullYear();\r\n  \r\n  const thisMonthOrders = purchaseOrders.filter(order => {\r\n    const orderDate = new Date(order.order_date);\r\n    return orderDate.getMonth() === currentMonth && \r\n           orderDate.getFullYear() === currentYear;\r\n  });\r\n\r\n  return (\r\n    <div className=\"container mx-auto\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-bold\">طلبات الشراء</h1>\r\n        <div className=\"flex gap-3\">\r\n          <Link href=\"/purchase-orders/monthly\" className=\"btn btn-secondary\">\r\n            إنشاء طلب شهري\r\n          </Link>\r\n          <Link href=\"/purchase-orders/new\" className=\"btn btn-primary\">\r\n            إنشاء طلب شراء\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Statistics Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\r\n        <div className=\"card bg-white\">\r\n          <h3 className=\"text-lg font-medium text-gray-700\">إجمالي الطلبات</h3>\r\n          <p className=\"mt-2 text-3xl font-bold\">{purchaseOrders.length}</p>\r\n        </div>\r\n        \r\n        <div className=\"card bg-yellow-50 border-r-4 border-yellow-500\">\r\n          <h3 className=\"text-lg font-medium text-gray-700\">طلبات معلقة</h3>\r\n          <p className=\"mt-2 text-3xl font-bold\">{pendingCount}</p>\r\n        </div>\r\n        \r\n        <div className=\"card bg-blue-50 border-r-4 border-blue-500\">\r\n          <h3 className=\"text-lg font-medium text-gray-700\">تم الاستلام</h3>\r\n          <p className=\"mt-2 text-3xl font-bold\">{receivedCount}</p>\r\n        </div>\r\n        \r\n        <div className=\"card bg-green-50 border-r-4 border-green-500\">\r\n          <h3 className=\"text-lg font-medium text-gray-700\">مكتملة</h3>\r\n          <p className=\"mt-2 text-3xl font-bold\">{completedCount}</p>\r\n        </div>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"bg-red-100 border-r-4 border-red-500 text-red-700 p-4 mb-6 rounded-md\">\r\n          <p>{error}</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Filters */}\r\n      <div className=\"bg-white shadow rounded-lg p-6 mb-6\">\r\n        <h2 className=\"text-lg font-semibold mb-4\">تصفية طلبات الشراء</h2>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div>\r\n            <label className=\"block mb-2 text-sm font-medium\">الحالة</label>\r\n            <select\r\n              value={filterStatus}\r\n              onChange={(e) => setFilterStatus(e.target.value)}\r\n              className=\"select w-full\"\r\n            >\r\n              <option value=\"\">جميع الحالات</option>\r\n              <option value=\"draft\">مسودة</option>\r\n              <option value=\"submitted\">مقدم</option>\r\n              <option value=\"approved\">معتمد</option>\r\n              <option value=\"ordered\">تم الطلب</option>\r\n              <option value=\"received\">تم الاستلام</option>\r\n              <option value=\"completed\">مكتمل</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div>\r\n            <label className=\"block mb-2 text-sm font-medium\">من تاريخ</label>\r\n            <input\r\n              type=\"date\"\r\n              value={dateRange.start}\r\n              onChange={(e) => setDateRange({ ...dateRange, start: e.target.value })}\r\n              className=\"input w-full\"\r\n            />\r\n          </div>\r\n          \r\n          <div>\r\n            <label className=\"block mb-2 text-sm font-medium\">إلى تاريخ</label>\r\n            <input\r\n              type=\"date\"\r\n              value={dateRange.end}\r\n              onChange={(e) => setDateRange({ ...dateRange, end: e.target.value })}\r\n              className=\"input w-full\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Monthly Summary */}\r\n      <div className=\"bg-white shadow-md rounded-lg p-6 mb-6\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h2 className=\"text-lg font-semibold\">طلبات الشهر الحالي ({thisMonthOrders.length})</h2>\r\n          {thisMonthOrders.length > 0 && (\r\n            <Link href={`/reports/monthly/${currentYear}/${currentMonth + 1}`} className=\"text-primary hover:underline\">\r\n              عرض التقرير الشهري\r\n            </Link>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          {thisMonthOrders.slice(0, 3).map(order => (\r\n            <div key={order.id} className=\"border rounded-md p-4 hover:bg-gray-50\">\r\n              <div className=\"flex justify-between items-center mb-2\">\r\n                <h3 className=\"font-medium\">طلب #{order.id.substring(0, 8)}</h3>\r\n                <StatusBadge status={order.status} />\r\n              </div>\r\n              <p className=\"text-gray-600 text-sm mb-2\" dir=\"ltr\">\r\n                {new Date(order.order_date).toLocaleDateString('ar-SA')}\r\n              </p>\r\n              <p className=\"text-gray-700\">\r\n                {order.total_amount ? `${order.total_amount} ريال` : 'المبلغ غير محدد'}\r\n              </p>\r\n              <div className=\"mt-3\">\r\n                <Link href={`/purchase-orders/${order.id}`} className=\"text-primary hover:underline text-sm\">\r\n                  عرض التفاصيل\r\n                </Link>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          \r\n          {thisMonthOrders.length === 0 && (\r\n            <div className=\"col-span-3 bg-gray-50 p-4 rounded-md text-center text-gray-500\">\r\n              لا توجد طلبات شراء لهذا الشهر\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Purchase Orders Table */}\r\n      <div className=\"bg-white shadow-md rounded-lg overflow-hidden\">\r\n        <div className=\"p-4 bg-gray-50 border-b\">\r\n          <h2 className=\"font-semibold text-lg\">جميع طلبات الشراء</h2>\r\n        </div>\r\n        \r\n        {loading ? (\r\n          <div className=\"text-center py-10\">\r\n            <p className=\"text-lg\">جاري تحميل البيانات...</p>\r\n          </div>\r\n        ) : filteredOrders.length === 0 ? (\r\n          <div className=\"text-center py-10\">\r\n            <p className=\"text-lg text-gray-500\">لا توجد طلبات شراء مطابقة للمعايير المحددة.</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    رقم الطلب\r\n                  </th>\r\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    التاريخ\r\n                  </th>\r\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    الحالة\r\n                  </th>\r\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    المبلغ الإجمالي\r\n                  </th>\r\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    المورد\r\n                  </th>\r\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    منشئ الطلب\r\n                  </th>\r\n                  <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    إجراءات\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {filteredOrders.map((order) => (\r\n                  <tr key={order.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      #{order.id.substring(0, 8)}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\" dir=\"ltr\">\r\n                      {new Date(order.order_date).toLocaleDateString('ar-SA')}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      <StatusBadge status={order.status} />\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      {order.total_amount ? `${order.total_amount} ريال` : 'غير محدد'}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      {order.vendor || 'غير محدد'}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                      {order.created_by}\r\n                    </td>\r\n                    <td className=\"px-4 py-4 whitespace-nowrap text-sm\">\r\n                      <Link \r\n                        href={`/purchase-orders/${order.id}`}\r\n                        className=\"text-secondary hover:underline ml-2\"\r\n                      >\r\n                        عرض\r\n                      </Link>\r\n                      \r\n                      {(order.status === 'draft' || order.status === 'submitted') && (\r\n                        <Link \r\n                          href={`/purchase-orders/${order.id}/edit`}\r\n                          className=\"text-primary hover:underline ml-2\"\r\n                        >\r\n                          تحرير\r\n                        </Link>\r\n                      )}\r\n                      \r\n                      {order.status === 'ordered' && (\r\n                        <Link \r\n                          href={`/purchase-orders/${order.id}/receive`}\r\n                          className=\"text-accent hover:underline\"\r\n                        >\r\n                          استلام\r\n                        </Link>\r\n                      )}\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Helper component for status badges\r\nfunction StatusBadge({ status }: { status: PurchaseOrder['status'] }) {\r\n  const statusColors: Record<PurchaseOrder['status'], { bg: string; text: string; label: string }> = {\r\n    draft: { bg: 'bg-gray-100', text: 'text-gray-800', label: 'مسودة' },\r\n    submitted: { bg: 'bg-blue-100', text: 'text-blue-800', label: 'مقدم' },\r\n    approved: { bg: 'bg-green-100', text: 'text-green-800', label: 'معتمد' },\r\n    ordered: { bg: 'bg-purple-100', text: 'text-purple-800', label: 'تم الطلب' },\r\n    received: { bg: 'bg-yellow-100', text: 'text-yellow-800', label: 'تم الاستلام' },\r\n    completed: { bg: 'bg-green-100', text: 'text-green-800', label: 'مكتمل' },\r\n  };\r\n\r\n  const { bg, text, label } = statusColors[status] || { bg: 'bg-gray-100', text: 'text-gray-800', label: status };\r\n\r\n  return (\r\n    <span className={`${bg} ${text} px-2 py-1 rounded-full text-xs`}>\r\n      {label}\r\n    </span>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1226, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// Since we're using the Edge build of Flight client for SSR [1], here we need to\n// also use the same Edge build to create the reference. For the client bundle,\n// we use the default and let Webpack to resolve it to the correct version.\n// 1: https://github.com/vercel/next.js/blob/16eb80b0b0be13f04a6407943664b5efd8f3d7d0/packages/next/src/server/app-render/use-flight-response.tsx#L24-L26\nexport const createServerReference = (\n  (!!process.env.NEXT_RUNTIME\n    ? // eslint-disable-next-line import/no-extraneous-dependencies\n      require('react-server-dom-webpack/client.edge')\n    : // eslint-disable-next-line import/no-extraneous-dependencies\n      require('react-server-dom-webpack/client')) as typeof import('react-server-dom-webpack/client')\n).createServerReference\n"],"names":["callServer","createServerReference","findSourceMapURL","process","env","NEXT_RUNTIME","require"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IASNC,qBAAqB,EAAA;eAArBA;;IARJC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;AAQ1B,MAAMD,wBACV,CAAA,CAAC,CAACE,QAAQC,GAAG,CAACC,YAAY,GAEvBC,QAAQ,0CAERA,QAAQ,8JAAiC,EAC7CL,qBAAqB","ignoreList":[0],"debugId":null}}]
}