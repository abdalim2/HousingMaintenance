{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/src/app/inventory/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { getInventory, getCategories } from '@/lib/services/inventoryService';\r\nimport { Inventory, Category, Item } from '@/models/types';\r\n\r\n// Extended type for inventory display with joined item info\r\ntype InventoryWithItem = Inventory & {\r\n  items: Item;\r\n};\r\n\r\nexport default function InventoryPage() {\r\n  const [inventory, setInventory] = useState<InventoryWithItem[]>([]);\r\n  const [categories, setCategories] = useState<Category[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Filter state\r\n  const [selectedCategory, setSelectedCategory] = useState<string>('');\r\n  const [searchTerm, setSearchTerm] = useState<string>('');\r\n  const [showLowStock, setShowLowStock] = useState<boolean>(false);\r\n  \r\n  // Load inventory and categories\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      try {\r\n        const [inventoryData, categoriesData] = await Promise.all([\r\n          getInventory(),\r\n          getCategories()\r\n        ]);\r\n        \r\n        setInventory(inventoryData as InventoryWithItem[]);\r\n        setCategories(categoriesData);\r\n      } catch (err) {\r\n        console.error('Error fetching inventory data:', err);\r\n        setError('حدث خطأ أثناء تحميل بيانات المخزون. الرجاء المحاولة مرة أخرى.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  // Filter inventory based on selected filters\r\n  const filteredInventory = inventory.filter(item => {\r\n    const matchesCategory = selectedCategory ? item.items.category_id === selectedCategory : true;\r\n    const matchesSearch = searchTerm \r\n      ? item.items.name.toLowerCase().includes(searchTerm.toLowerCase()) \r\n      : true;\r\n    const matchesLowStock = showLowStock ? item.quantity <= 5 : true;\r\n    \r\n    return matchesCategory && matchesSearch && matchesLowStock;\r\n  });\r\n\r\n  // Group by category for display\r\n  const inventoryByCategory = filteredInventory.reduce((acc, item) => {\r\n    const categoryId = item.items.category_id;\r\n    if (!acc[categoryId]) {\r\n      acc[categoryId] = [];\r\n    }\r\n    acc[categoryId].push(item);\r\n    return acc;\r\n  }, {} as Record<string, InventoryWithItem[]>);\r\n\r\n  return (\r\n    <div className=\"container mx-auto\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-bold dark:text-white\">المخزون</h1>\r\n        <div className=\"flex gap-3\">\r\n          <Link href=\"/inventory/categories\" className=\"btn btn-secondary\">\r\n            إدارة الأصناف\r\n          </Link>\r\n          <Link href=\"/inventory/add\" className=\"btn btn-primary\">\r\n            إضافة مخزون\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"bg-red-100 border-r-4 border-red-500 text-red-700 p-4 mb-6 rounded-md dark:bg-red-900/30 dark:border-red-800 dark:text-red-400\">\r\n          <p>{error}</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Filters */}\r\n      <div className=\"bg-white shadow rounded-lg p-6 mb-6 dark:bg-gray-800\">\r\n        <h2 className=\"text-lg font-semibold mb-4 dark:text-white\">تصفية المخزون</h2>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div>\r\n            <label className=\"block mb-2 text-sm font-medium dark:text-gray-300\">البحث بالاسم</label>\r\n            <input\r\n              type=\"text\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              placeholder=\"ادخل اسم الصنف...\"\r\n              className=\"input w-full dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n            />\r\n          </div>\r\n          \r\n          <div>\r\n            <label className=\"block mb-2 text-sm font-medium dark:text-gray-300\">التصنيف</label>\r\n            <select\r\n              value={selectedCategory}\r\n              onChange={(e) => setSelectedCategory(e.target.value)}\r\n              className=\"select w-full dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n            >\r\n              <option value=\"\">جميع التصنيفات</option>\r\n              {categories.map(category => (\r\n                <option key={category.id} value={category.id}>\r\n                  {category.name}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          \r\n          <div className=\"flex items-end\">\r\n            <label className=\"flex items-center dark:text-gray-300\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={showLowStock}\r\n                onChange={(e) => setShowLowStock(e.target.checked)}\r\n                className=\"w-5 h-5 ml-2 checkbox dark:border-gray-600 dark:bg-gray-700\"\r\n              />\r\n              <span>عرض المخزون المنخفض فقط (أقل من 5)</span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Inventory List */}\r\n      {loading ? (\r\n        <div className=\"text-center py-10 dark:text-gray-300\">\r\n          <p className=\"text-lg\">جاري تحميل البيانات...</p>\r\n        </div>\r\n      ) : filteredInventory.length === 0 ? (\r\n        <div className=\"bg-white shadow-md rounded-lg p-6 text-center dark:bg-gray-800\">\r\n          <p className=\"text-lg text-gray-500 dark:text-gray-400\">لا توجد أصناف مطابقة للمعايير المحددة.</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-6\">\r\n          {Object.keys(inventoryByCategory).map(categoryId => {\r\n            const categoryName = categories.find(c => c.id === categoryId)?.name || 'تصنيف غير معروف';\r\n            const items = inventoryByCategory[categoryId];\r\n            \r\n            return (\r\n              <div key={categoryId} className=\"bg-white shadow-md rounded-lg overflow-hidden dark:bg-gray-800\">\r\n                <div className=\"bg-gray-50 p-4 border-b dark:bg-gray-700 dark:border-gray-600\">\r\n                  <h3 className=\"text-lg font-semibold dark:text-white\">{categoryName}</h3>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n                    <thead className=\"bg-gray-50 dark:bg-gray-700\">\r\n                      <tr>\r\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">\r\n                          الصنف\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">\r\n                          الكمية المتوفرة\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">\r\n                          الوحدة\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">\r\n                          سعر الوحدة\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">\r\n                          آخر تحديث\r\n                        </th>\r\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">\r\n                          إجراءات\r\n                        </th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\">\r\n                      {items.map((item) => (\r\n                        <tr \r\n                          key={item.id} \r\n                          className={`hover:bg-gray-50 dark:hover:bg-gray-700 ${\r\n                            item.quantity <= 5 \r\n                              ? 'bg-red-50 dark:bg-red-900/20' \r\n                              : 'dark:bg-gray-800'\r\n                          }`}\r\n                        >\r\n                          <td className=\"px-4 py-4 dark:text-gray-300\">\r\n                            {item.items.name}\r\n                          </td>\r\n                          <td className=\"px-4 py-4\">\r\n                            <span className={item.quantity <= 5 ? 'font-bold text-red-600 dark:text-red-400' : 'dark:text-gray-300'}>\r\n                              {item.quantity}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-4 py-4 dark:text-gray-300\">\r\n                            {item.items.unit}\r\n                          </td>\r\n                          <td className=\"px-4 py-4 dark:text-gray-300\">\r\n                            {item.unit_price ? `${item.unit_price} ريال` : 'غير محدد'}\r\n                          </td>\r\n                          <td className=\"px-4 py-4 dark:text-gray-300\" dir=\"ltr\">\r\n                            {new Date(item.last_updated).toLocaleDateString('ar-SA')}\r\n                          </td>\r\n                          <td className=\"px-4 py-4 text-sm\">\r\n                            <Link \r\n                              href={`/inventory/adjust/${item.id}`}\r\n                              className=\"text-primary hover:underline ml-2 dark:text-blue-400\"\r\n                            >\r\n                              تعديل الكمية\r\n                            </Link>\r\n                            <Link \r\n                              href={`/inventory/history/${item.items.id}`}\r\n                              className=\"text-secondary hover:underline dark:text-purple-400\"\r\n                            >\r\n                              سجل الحركة\r\n                            </Link>\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n      \r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8\">\r\n        <div className=\"card bg-white dark:bg-gray-800\">\r\n          <h3 className=\"text-lg font-medium text-gray-700 dark:text-gray-300\">إجمالي الأصناف</h3>\r\n          <p className=\"mt-2 text-3xl font-bold dark:text-white\">{inventory.length}</p>\r\n        </div>\r\n        \r\n        <div className=\"card bg-white dark:bg-gray-800\">\r\n          <h3 className=\"text-lg font-medium text-gray-700 dark:text-gray-300\">الأصناف منخفضة المخزون</h3>\r\n          <p className=\"mt-2 text-3xl font-bold text-amber-600 dark:text-amber-500\">\r\n            {inventory.filter(item => item.quantity <= 5).length}\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"card bg-white dark:bg-gray-800\">\r\n          <h3 className=\"text-lg font-medium text-gray-700 dark:text-gray-300\">التصنيفات</h3>\r\n          <p className=\"mt-2 text-3xl font-bold dark:text-white\">{categories.length}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}