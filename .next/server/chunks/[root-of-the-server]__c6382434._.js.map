{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/src/lib/neondb.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\n// استخدام عنوان الاتصال المباشر بقاعدة بيانات Neon\r\nconst connectionString = 'postgresql://HousingMaintenance_owner:npg_fC8S4bpZLsJw@ep-weathered-meadow-a44a1v3i-pooler.us-east-1.aws.neon.tech/HousingMaintenance?sslmode=require';\r\n\r\n// إنشاء تجمع اتصالات لقاعدة البيانات\r\nexport const pool = new Pool({\r\n  connectionString,\r\n});\r\n\r\n// وظيفة مساعدة لتنفيذ استعلامات قاعدة البيانات\r\nexport async function query(text: string, params?: any[]) {\r\n  const client = await pool.connect();\r\n  try {\r\n    const result = await client.query(text, params);\r\n    return result;\r\n  } finally {\r\n    client.release();\r\n  }\r\n}\r\n\r\n// التحقق من اتصال قاعدة البيانات\r\nexport async function testConnection() {\r\n  try {\r\n    const result = await query('SELECT NOW()');\r\n    console.log('اتصال ناجح بقاعدة بيانات Neon:', result.rows[0]);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('فشل الاتصال بقاعدة بيانات Neon:', error);\r\n    return false;\r\n  }\r\n}"],"names":[],"mappings":";;;;;AAAA;;;;;;AAEA,mDAAmD;AACnD,MAAM,mBAAmB;AAGlB,MAAM,OAAO,IAAI,oGAAA,CAAA,OAAI,CAAC;IAC3B;AACF;AAGO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO;IACT,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,MAAM;QAC3B,QAAQ,GAAG,CAAC,kCAAkC,OAAO,IAAI,CAAC,EAAE;QAC5D,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/MohammedAlabdali/HousingMaintenance/src/app/api/housing/buildings/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { query } from '@/lib/neondb';\r\n\r\nexport async function GET(request: Request) {\r\n  try {\r\n    console.log('[API] GET /api/housing/buildings - Starting request');\r\n    \r\n    // Extract query parameters\r\n    const { searchParams } = new URL(request.url);\r\n    const complexId = searchParams.get('complexId');\r\n    \r\n    console.log(`[API] Fetching buildings for complexId: ${complexId || 'all'}`);\r\n    \r\n    // Build SQL query\r\n    let sqlQuery = 'SELECT * FROM buildings';\r\n    const params: any[] = [];\r\n    \r\n    // Add filters\r\n    if (complexId) {\r\n      sqlQuery += ' WHERE complex_id = $1';\r\n      params.push(complexId);\r\n    }\r\n    \r\n    // Execute query with detailed error handling\r\n    try {\r\n      const result = await query(sqlQuery, params);\r\n      \r\n      console.log(`[API] Successfully fetched ${result.rows.length} buildings`);\r\n      return NextResponse.json(result.rows || []);\r\n    } catch (queryError: any) {\r\n      console.error('[API] Exception during query execution:', queryError);\r\n      return NextResponse.json(\r\n        { error: `Query execution failed: ${queryError.message}` }, \r\n        { status: 500 }\r\n      );\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[API] Unexpected error in buildings API:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch buildings: ' + (error.message || 'Unknown error') }, \r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const building = await request.json();\r\n    \r\n    // Validate required fields\r\n    if (!building.name || !building.complex_id) {\r\n      return NextResponse.json(\r\n        { error: 'Building name and complex ID are required' }, \r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    // Extract fields from building object\r\n    const fields = Object.keys(building);\r\n    const values = fields.map((field) => building[field]);\r\n    const placeholders = fields.map((_, index) => `$${index + 1}`).join(', ');\r\n    \r\n    // Build INSERT query\r\n    const sqlQuery = \r\n      `INSERT INTO buildings (${fields.join(', ')}) \r\n       VALUES (${placeholders})\r\n       RETURNING *`;\r\n    \r\n    const result = await query(sqlQuery, values);\r\n    \r\n    if (!result.rowCount) {\r\n      return NextResponse.json(\r\n        { error: 'Failed to create building' }, \r\n        { status: 500 }\r\n      );\r\n    }\r\n    \r\n    return NextResponse.json(result.rows[0]);\r\n  } catch (error: any) {\r\n    console.error('Unexpected error creating building:', error);\r\n    return NextResponse.json(\r\n      { error: `Failed to create building: ${error.message}` }, \r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(request: Request) {\r\n  try {\r\n    const updates = await request.json();\r\n    const { id, ...buildingData } = updates;\r\n    \r\n    if (!id) {\r\n      return NextResponse.json({ error: 'Building ID is required' }, { status: 400 });\r\n    }\r\n    \r\n    // Build the SET part of the query\r\n    const fields = Object.keys(buildingData);\r\n    const setClause = fields\r\n      .map((field, index) => `${field} = $${index + 2}`)\r\n      .join(', ');\r\n    \r\n    // Build values array\r\n    const values = [id, ...fields.map(field => buildingData[field])];\r\n    \r\n    // Build UPDATE query\r\n    const sqlQuery = \r\n      `UPDATE buildings \r\n       SET ${setClause}\r\n       WHERE id = $1\r\n       RETURNING *`;\r\n    \r\n    const result = await query(sqlQuery, values);\r\n    \r\n    if (!result.rowCount) {\r\n      return NextResponse.json(\r\n        { error: 'Building not found or no changes made' }, \r\n        { status: 404 }\r\n      );\r\n    }\r\n    \r\n    return NextResponse.json(result.rows[0]);\r\n  } catch (error: any) {\r\n    console.error('Unexpected error updating building:', error);\r\n    return NextResponse.json(\r\n      { error: `Failed to update building: ${error.message}` }, \r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: Request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const id = searchParams.get('id');\r\n    \r\n    if (!id) {\r\n      return NextResponse.json({ error: 'Building ID is required' }, { status: 400 });\r\n    }\r\n    \r\n    // Delete building\r\n    const sqlQuery = 'DELETE FROM buildings WHERE id = $1';\r\n    const result = await query(sqlQuery, [id]);\r\n    \r\n    if (!result.rowCount) {\r\n      return NextResponse.json(\r\n        { error: 'Building not found' }, \r\n        { status: 404 }\r\n      );\r\n    }\r\n    \r\n    return NextResponse.json({ success: true });\r\n  } catch (error: any) {\r\n    console.error('Unexpected error deleting building:', error);\r\n    return NextResponse.json(\r\n      { error: `Failed to delete building: ${error.message}` }, \r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}