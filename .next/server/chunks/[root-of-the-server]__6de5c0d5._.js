module.exports = {

"[project]/.next-internal/server/app/api/diagnostics/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[project]/src/lib/supabase.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "postgresUrl": (()=>postgresUrl),
    "supabase": (()=>supabase)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
// Initialize the Supabase client with proper Supabase URL and key
const supabaseUrl = 'https://mticvmyfrdmciaeipfxu.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10aWN2bXlmcmRtY2lhZWlwZnh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwODc1OTMsImV4cCI6MjA1NjY2MzU5M30.6iudxBl6js0heW1mhoSmcXegTIN_lAN2GiFeA3plSIo';
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseKey);
const postgresUrl = 'postgresql://HousingMaintenance_owner:npg_fC8S4bpZLsJw@ep-weathered-meadow-a44a1v3i-pooler.us-east-1.aws.neon.tech/HousingMaintenance?sslmode=require';
}}),
"[project]/src/lib/services/maintenanceService.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "checkMaintenanceTablesExist": (()=>checkMaintenanceTablesExist),
    "createMaintenanceItem": (()=>createMaintenanceItem),
    "createMaintenanceRequest": (()=>createMaintenanceRequest),
    "deleteMaintenanceItem": (()=>deleteMaintenanceItem),
    "deleteMaintenanceRequest": (()=>deleteMaintenanceRequest),
    "getMaintenanceItemById": (()=>getMaintenanceItemById),
    "getMaintenanceItems": (()=>getMaintenanceItems),
    "getMaintenanceRequestById": (()=>getMaintenanceRequestById),
    "getMaintenanceRequests": (()=>getMaintenanceRequests),
    "getMonthlyMaintenanceRequests": (()=>getMonthlyMaintenanceRequests),
    "updateMaintenanceItem": (()=>updateMaintenanceItem),
    "updateMaintenanceRequest": (()=>updateMaintenanceRequest)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/supabase.ts [app-route] (ecmascript)");
;
const checkMaintenanceTablesExist = async ()=>{
    try {
        // Try to get just one record to check if the table exists
        const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_requests').select('id').limit(1);
        if (error) {
            if (error.message.includes('does not exist')) {
                return {
                    exists: false,
                    message: 'The maintenance_requests table does not exist. Database initialization is required.'
                };
            }
            return {
                exists: false,
                message: `Error checking table: ${error.message}`
            };
        }
        return {
            exists: true,
            message: 'Table exists and is accessible'
        };
    } catch (err) {
        return {
            exists: false,
            message: `Error checking maintenance tables: ${err.message}`
        };
    }
};
const getMaintenanceRequests = async (complexId, buildingId, status)=>{
    try {
        // Check if table exists first
        const tableStatus = await checkMaintenanceTablesExist();
        if (!tableStatus.exists) {
            console.warn(`Table check warning: ${tableStatus.message}`);
            return []; // Return empty array instead of throwing
        }
        let query = __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_requests').select('*');
        if (complexId) {
            query = query.eq('complex_id', complexId);
        }
        if (buildingId) {
            query = query.eq('building_id', buildingId);
        }
        if (status) {
            query = query.eq('status', status);
        }
        const { data, error } = await query.order('reported_date', {
            ascending: false
        });
        if (error) {
            console.error('Supabase error in getMaintenanceRequests:', error);
            return []; // Return empty array on error
        }
        return data || [];
    } catch (err) {
        console.error('Error in getMaintenanceRequests:', err);
        return []; // Return empty array on error
    }
};
const getMaintenanceRequestById = async (id)=>{
    try {
        // Check if table exists first
        const tableStatus = await checkMaintenanceTablesExist();
        if (!tableStatus.exists) {
            console.warn(`Table check warning: ${tableStatus.message}`);
            return null;
        }
        const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_requests').select('*').eq('id', id).single();
        if (error) {
            console.error('Error fetching maintenance request:', error);
            return null;
        }
        return data;
    } catch (err) {
        console.error('Error in getMaintenanceRequestById:', err);
        return null;
    }
};
const createMaintenanceRequest = async (request)=>{
    try {
        // Check if table exists first
        const tableStatus = await checkMaintenanceTablesExist();
        if (!tableStatus.exists) {
            throw new Error(`Cannot create maintenance request: ${tableStatus.message}`);
        }
        const newRequest = {
            ...request,
            reported_date: new Date().toISOString(),
            status: request.status || 'pending'
        };
        const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_requests').insert([
            newRequest
        ]).select().single();
        if (error) throw error;
        return data;
    } catch (err) {
        console.error('Error creating maintenance request:', err);
        throw new Error(`Failed to create maintenance request: ${err.message}`);
    }
};
const updateMaintenanceRequest = async (id, updates)=>{
    try {
        // Check if table exists first
        const tableStatus = await checkMaintenanceTablesExist();
        if (!tableStatus.exists) {
            throw new Error(`Cannot update maintenance request: ${tableStatus.message}`);
        }
        const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_requests').update(updates).eq('id', id).select().single();
        if (error) throw error;
        return data;
    } catch (err) {
        console.error('Error updating maintenance request:', err);
        throw new Error(`Failed to update maintenance request: ${err.message}`);
    }
};
const deleteMaintenanceRequest = async (id)=>{
    try {
        // Check if table exists first
        const tableStatus = await checkMaintenanceTablesExist();
        if (!tableStatus.exists) {
            throw new Error(`Cannot delete maintenance request: ${tableStatus.message}`);
        }
        const { error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_requests').delete().eq('id', id);
        if (error) throw error;
    } catch (err) {
        console.error('Error deleting maintenance request:', err);
        throw new Error(`Failed to delete maintenance request: ${err.message}`);
    }
};
const getMaintenanceItems = async (maintenanceId)=>{
    const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_items').select('*').eq('maintenance_id', maintenanceId);
    if (error) throw error;
    return data || [];
};
const getMaintenanceItemById = async (id)=>{
    const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_items').select('*').eq('id', id).single();
    if (error) throw error;
    return data;
};
const createMaintenanceItem = async (item)=>{
    const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_items').insert([
        item
    ]).select().single();
    if (error) throw error;
    return data;
};
const updateMaintenanceItem = async (id, updates)=>{
    const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_items').update(updates).eq('id', id).select().single();
    if (error) throw error;
    return data;
};
const deleteMaintenanceItem = async (id)=>{
    const { error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_items').delete().eq('id', id);
    if (error) throw error;
};
const getMonthlyMaintenanceRequests = async (year, month)=>{
    // Create start and end date for the specified month
    const startDate = new Date(year, month - 1, 1).toISOString();
    const endDate = new Date(year, month, 0).toISOString();
    const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('maintenance_requests').select('*').gte('reported_date', startDate).lte('reported_date', endDate);
    if (error) throw error;
    return data || [];
};
}}),
"[externals]/pg [external] (pg, esm_import)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
const mod = await __turbopack_context__.y("pg");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[project]/src/app/api/diagnostics/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
__turbopack_context__.s({
    "GET": (()=>GET),
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/supabase.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$maintenanceService$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/services/maintenanceService.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/pg [external] (pg, esm_import)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__
]);
([__TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
;
;
;
;
;
// Table list to check for existence
const REQUIRED_TABLES = [
    'users',
    'maintenance_requests',
    'residential_complexes',
    'buildings',
    'maintenance_items',
    'rooms',
    'facilities',
    'categories',
    'items',
    'inventory',
    'purchase_orders',
    'purchase_items'
];
// Function to run database setup directly without spawning a process
async function executeDbSetup() {
    try {
        // Using the same connection string from init-pg-db.js
        const connectionString = 'postgresql://HousingMaintenance_owner:npg_fC8S4bpZLsJw@ep-weathered-meadow-a44a1v3i-pooler.us-east-1.aws.neon.tech/HousingMaintenance?sslmode=require';
        const pool = new __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__["Pool"]({
            connectionString
        });
        const client = await pool.connect();
        console.log('Connected to database, reading SQL file...');
        let sqlFilePath;
        const projectRoot = process.cwd();
        // Try to find the SQL file with different path combinations
        const possiblePaths = [
            __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(projectRoot, 'scripts', 'init_database.sql'),
            __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(projectRoot, '..', 'scripts', 'init_database.sql'),
            __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(projectRoot, '../..', 'scripts', 'init_database.sql')
        ];
        for (const tryPath of possiblePaths){
            if (__TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].existsSync(tryPath)) {
                sqlFilePath = tryPath;
                break;
            }
        }
        if (!sqlFilePath) {
            return {
                success: false,
                details: `SQL file not found. Tried paths: ${possiblePaths.join(', ')}`
            };
        }
        console.log(`Found SQL file at: ${sqlFilePath}`);
        const sqlScript = __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].readFileSync(sqlFilePath, 'utf8');
        try {
            // Execute SQL script
            await client.query(sqlScript);
            console.log('Database initialization completed successfully');
            return {
                success: true,
                details: 'Database tables created successfully'
            };
        } catch (error) {
            console.error('Error executing SQL:', error);
            return {
                success: false,
                details: `Error executing SQL: ${error.message}`
            };
        } finally{
            client.release();
            await pool.end();
        }
    } catch (error) {
        console.error('Database setup error:', error);
        return {
            success: false,
            details: `Database initialization failed: ${error.message}`
        };
    }
}
async function GET() {
    try {
        // Test connection by attempting to fetch the database version
        const { data: versionData, error: versionError } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].rpc('version');
        if (versionError) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                status: 'error',
                message: 'Failed to connect to database',
                error: versionError.message,
                details: versionError
            }, {
                status: 500
            });
        }
        // Check all required tables
        const tableResults = {};
        const missingTables = [];
        for (const table of REQUIRED_TABLES){
            const exists = await checkTableExists(table);
            tableResults[table] = exists;
            if (!exists) {
                missingTables.push(table);
            }
        }
        // Get details from maintenance specific check
        const maintenanceTablesStatus = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$maintenanceService$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["checkMaintenanceTablesExist"])();
        // Determine overall database status
        const databaseStatus = missingTables.length === 0 ? 'ready' : missingTables.length === REQUIRED_TABLES.length ? 'uninitialized' : 'partial';
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            status: 'success',
            message: 'Successfully connected to Supabase',
            databaseStatus,
            version: versionData,
            tables: tableResults,
            missingTables,
            maintenanceTablesDetails: maintenanceTablesStatus,
            setupRequired: missingTables.length > 0
        });
    } catch (err) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            status: 'error',
            message: 'Failed to run diagnostic tests',
            error: err.message
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        const { action } = await request.json();
        if (action === 'setup_database') {
            // First check current database status
            const diagnosticsResult = {};
            for (const table of REQUIRED_TABLES){
                diagnosticsResult[table] = await checkTableExists(table);
            }
            // Execute database setup directly instead of spawning a process
            const setupResult = await executeDbSetup();
            if (setupResult.success) {
                // After setup, verify that tables were created
                const verificationResult = {};
                let allTablesCreated = true;
                for (const table of REQUIRED_TABLES){
                    const exists = await checkTableExists(table);
                    verificationResult[table] = exists;
                    if (!exists) {
                        allTablesCreated = false;
                    }
                }
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    success: allTablesCreated,
                    message: allTablesCreated ? 'تم إعداد قاعدة البيانات بنجاح' : 'تم تنفيذ سكريبت الإعداد، لكن بعض الجداول لم يتم إنشاؤها',
                    details: setupResult.details,
                    beforeSetup: diagnosticsResult,
                    afterSetup: verificationResult
                });
            } else {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    success: false,
                    error: 'فشل إعداد قاعدة البيانات',
                    details: setupResult.details
                }, {
                    status: 500
                });
            }
        } else if (action === 'fix_user_dependency') {
            // تنفيذ إصلاح مشكلة المستخدم في جدول طلبات الصيانة
            const result = await fixUserDependency();
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                success: result.success,
                message: result.success ? 'تم إصلاح مشكلة المستخدم بنجاح' : 'فشل إصلاح مشكلة المستخدم',
                details: result.details
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: 'إجراء غير معروف'
        }, {
            status: 400
        });
    } catch (error) {
        console.error('Error in diagnostic API:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: error.message || 'حدث خطأ أثناء تنفيذ العملية'
        }, {
            status: 500
        });
    }
}
// Function to fix the user dependency issue in maintenance_requests
async function fixUserDependency() {
    try {
        // Check if users table exists
        const usersExist = await checkTableExists('users');
        if (!usersExist) {
            // Create admin user first
            const { error: userError } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('users').insert([
                {
                    email: 'admin@example.com',
                    full_name: 'Admin User',
                    role: 'admin'
                }
            ]);
            if (userError) {
                return {
                    success: false,
                    details: `Failed to create admin user: ${userError.message}`
                };
            }
        }
        // Get the admin user id
        const { data: adminUser, error: fetchError } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('users').select('id').eq('email', 'admin@example.com').single();
        if (fetchError || !adminUser) {
            return {
                success: false,
                details: `Could not find or create admin user: ${fetchError?.message || 'No user found'}`
            };
        }
        return {
            success: true,
            details: `User dependency fix available with admin user ID: ${adminUser.id}`
        };
    } catch (error) {
        return {
            success: false,
            details: `Error fixing user dependency: ${error.message}`
        };
    }
}
async function checkTableExists(tableName) {
    try {
        // Try to get a single row from the table
        const { data, error } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from(tableName).select('*').limit(1);
        if (error && error.message.includes('does not exist')) {
            return false;
        }
        return true;
    } catch (err) {
        return false;
    }
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__6de5c0d5._.js.map